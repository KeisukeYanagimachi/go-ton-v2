# 01_application_spec.md

## アプリケーション仕様（業務仕様・要件定義）

---

## ChangeLog

- 2026-01-11: 試験中の全画面化と離脱警告（ベストエフォート）を明文化
- 2026-01-11: 試験中の画面内注意文言（離脱警告）を明文化
- 2026-01-11: Staff の Attempt 一覧・検索・引き継ぎ操作の業務要件を明文化
- 2026-01-11: 受験票再発行の入力・結果表示・エラー条件を明文化
- 2026-01-11: 試験定義（Exam / ExamVersion / Module）の運用要件を明文化
- 2026-01-11: 受験票再発行の対象条件に「未受験（Attempt 未作成）」を明記

---

## 1. 本資料の位置づけ

本資料は、社内SPIアプリにおける **業務仕様（What / Why）** を定義するものである。
技術的な実装方法（How）は `02_technical_spec.md` 以降に委ね、本資料では以下を明確にする。

- 誰が使うのか
- 何ができなければならないのか
- 運用上、何が必須なのか
- どこまでがスコープに含まれるのか

---

## 2. アプリ概要

### 2.1 目的

- 社内で実施する SPI 試験（能力検査）を Web アプリとして提供する
- 会場受験を前提とし、紙・手作業に依存しない試験運用を実現する
- 受験者・運営者双方にとって「信頼できる」「しっかりした」体験を提供する

### 2.2 前提条件

- 受験者は **事前に特定されている**
- 試験は **原則会場で実施**する
- 会場では **一人一台のPC**を基本とするが、端末トラブル時の引き継ぎを想定する
- 外部向けサービスではなく **社内利用システム**である

---

## 3. ユーザー区分

### 3.1 Candidate（受験者）

- 応募者として事前に登録された人物
- 試験会場のPCを使用して受験する
- 自身のアカウント管理・登録作業は行わない

### 3.2 Staff（運営者）

- 社内の人事・面接官・運営担当者
- 会社の Google Workspace アカウントを保有している
- 試験の準備・当日運用・結果確認を行う

---

## 4. 認証・ログイン動線（業務視点）

### 4.1 Staff ログイン

- Google Workspace アカウントによるログイン
- 事前に登録された staff のみが利用可能（ホワイトリスト方式）
- 社内ドメイン一致だけではログイン不可

### 4.2 Candidate ログイン

- 以下2要素による認証を必須とする
  - 受験票（QRコードまたはコード入力）
  - PIN（生年月日）

#### 業務的な狙い

- メールが見られないケースを想定し、QRは紙/スマホ両対応
- 当日スタッフが介入できる余地を残す
- 不正受験・なりすましを抑止する

---

## 5. 試験の業務仕様（SPI3準拠）

### 5.1 実施対象

- 能力検査のみを実施する
- 性格検査は **現時点では実施しない**

※ ただし、将来的な追加要望を想定し、
「後からDB構造を変えずに追加できる」設計を前提とする。

---

### 5.2 試験モジュール

以下の4モジュールを **常に実施**する。

| モジュール | 内容                 |
| ---------- | -------------------- |
| VERBAL     | 言語能力             |
| NONVERBAL  | 非言語（数的・論理） |
| ENGLISH    | 英語                 |
| STRUCTURAL | 構造的把握力         |

- 試験バージョンごとに問題内容・配点・時間配分は変更可能
- モジュール自体の有無は固定（4つ必須）

---

### 5.3 モジュール順序

- 実施順は **固定**
- 試験編成時に定義された順序で進行する
- 受験者は順序を選択できない
- 完了したモジュールに戻ることはできない

---

### 5.4 時間配分

- モジュールごとに制限時間を設定する
- 時間配分は **試験バージョンごとに自由に設定可能**
- 公開済みの試験バージョンは変更不可
  - 変更が必要な場合は新バージョンを作成する

---

## 6. 問題仕様（業務視点）

### 6.1 問題形式

- 選択式のみ
- 単一選択
- 正解は必ず1つ存在する

### 6.2 分類

- 問題は分野（カテゴリ）で分類できる
- 分類は以下を目的とする
  - 作問・問題管理
  - 成績分析
  - 試験内容の把握

---

## 7. 受験フロー（Candidate）

1. 受験票提示（QR読み取り or コード入力）
2. PIN（生年月日）入力
3. 試験開始
4. モジュール順に問題を解答
5. 試験提出
6. 完了画面表示

### 業務上の注意点

- 試験開始後は、意図せず中断しない設計とする
- 端末トラブル時は staff が介入できる

### 7.1 試験中の表示・離脱警告（必須）

- 試験画面は **全画面表示**を試みる（ブラウザ制約により失敗する場合は通常表示にフォールバック）
- 自動全画面化が拒否される場合は、**初回のユーザー操作時に再試行**する
- リロード／タブ・ブラウザのクローズ等の離脱操作時に、**ブラウザ標準の確認ダイアログ**を表示する
  - ブラウザの制約により完全な離脱抑止はできないため、**ベストエフォート**とする
- 試験画面内に、以下の注意文を常時表示する
  - 文言（固定）: `試験中は画面を閉じないでください。終了や移動を行うと、回答内容が失われる可能性があります。`

---

## 8. 当日運用（Staff）

### 8.1 受験票の再発行

- 受験者がメールを見られない、QRを失った等のケースを想定
- staff は対象 candidate に対して受験票を再発行できる
- 再発行時、旧チケットは無効化される
- 再発行は **受験票コード（ticket_code）** によって行う
- 再発行の対象は **ACTIVE の ticket のみ**とする
  - REVOKED / USED の ticket は対象外
- **Attempt が作成済みの ticket は再発行不可**
  - 試験終了済み（SUBMITTED / SCORED）は再発行不可
  - 受験中（IN_PROGRESS / LOCKED）も再発行不可
- 再発行の結果として以下を表示する
  - 新しい受験票コード（new ticket code）
  - 旧チケットが無効化されたこと
- 再発行操作は **ADMIN / PROCTOR** が実行できる

---

### 8.2 試験の引き継ぎ（必須要件）

- PCトラブル等に備え、別端末で受験を継続できる
- 引き継ぎは staff 操作によって行う
- 以下の状態を保持して再開できること
  - 現在のモジュール
  - 回答済み内容
  - 残り時間
  - 行動計測データ

### 8.3 Attempt 一覧・検索・引き継ぎ操作（必須要件）

- Staff は、当日運用のために Attempt を一覧で確認できる
- 一覧から対象 Attempt を特定できること
  - 必須の検索条件: **受験票コード（ticket_code）**
  - 併用できる絞り込み: **Attempt 状態（IN_PROGRESS / LOCKED / SUBMITTED 等）**
- 一覧に表示する必須項目
  - Attempt ID
  - Candidate 氏名
  - 受験票コード（ticket_code）
  - Attempt 状態
  - 最終更新日時（updated_at）
- 一覧から引き継ぎ操作（LOCK / RESUME）を実行できる
  - LOCK は IN_PROGRESS の Attempt のみ対象
  - RESUME は LOCKED の Attempt のみ対象
  - 操作結果は一覧上で即時に確認できる

### 8.4 試験定義の管理（必須要件）

- Staff は試験（Exam）と試験バージョン（ExamVersion）を管理できる
- ExamVersion は以下の状態を持つ
  - DRAFT / PUBLISHED / ARCHIVED
- 遷移は次のみ許可する
  - DRAFT → PUBLISHED
  - PUBLISHED → ARCHIVED
- PUBLISHED の ExamVersion は編集不可
  - 変更が必要な場合は **新しい ExamVersion を作成**する
- 試験バージョンは **常に1つの Exam に紐づく**

#### モジュール構成・時間配分（必須）

- ExamVersion ごとにモジュール構成と制限時間を設定できる
- 必須モジュール
  - VERBAL / NONVERBAL / ENGLISH / STRUCTURAL
- モジュール順序は position で固定し、重複は不可
- 制限時間は module ごとに保持する

---

## 9. 行動計測（業務要件）

### 9.1 目的

- 「適当に答えたか」「考えて答えたか」を判断する **材料**を得る
- 単純な点数だけで判断しないための補助情報とする

### 9.2 記録する内容

- 問題ごとの表示時間
- 操作が行われていた時間
- 表示回数
- 回答変更回数

### 9.3 判定方針

- 計測結果のみで断定は行わない
- あくまで運営・評価の **参考情報**として扱う

---

## 10. スコープ外（明確に除外）

以下は本アプリのスコープ外とする。

- 自宅受験・リモート受験
- 応募者情報の自動取り込み（就活サイト連携等）
- 性格検査の実施（将来拡張点としてのみ考慮）
- 不正行為の自動検出・自動失格判定

---

## 11. 業務仕様としての不変条件

- 試験は公平であること
- 受験者体験が途中で破綻しないこと
- 運営者が当日トラブルに対応できること
- 「公開済みの試験内容が後から変わらない」こと

---

## 12. 次に読むべき資料

- `02_technical_spec.md`
  （本仕様を満たすための技術スタック・アーキテクチャ定義）
